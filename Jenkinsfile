pipeline { agent any stages { stage('Build') { steps { sh 'docker build -t my-app .' } } stage('Test') { steps { sh 'docker run my-app npm test' } } stage('Deploy') { steps { sh 'docker tag my-app my-registry:5000/my-app' sh 'docker push my-registry:5000/my-app' sh 'ssh user@my-server "docker pull my-registry:5000/my-app && docker run -d -p 80:3000 my-registry:5000/my-app"' } } } }
